<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Redis队列状态监控</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="/static/plugs/layui/css/layui.css">
    <style>
        .container {padding: 20px;}
        .queue-table {margin-top: 20px;}
        .title {margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee;}
        .clear-btn {background-color: #FF5722; color: white;}
    </style>
</head>
<body>
<div class="container">
    <h2 class="title">Redis队列状态列表</h2>
    <table class="layui-table queue-table">
        <colgroup>
            <col width="35%">
            <col width="15%">
            <col width="30%">
            <col width="20%">
        </colgroup>
        <thead>
        <tr>
            <th>队列名称</th>
            <th>队列长度</th>
            <th>更新时间</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        {volist name="queues" id="queue"}
        <tr>
            <td>{$queue.queue_name}</td>
            <td>{$queue.length}</td>
            <td>{$queue.update_time}</td>
            <td>
                <button class="layui-btn layui-btn-sm clear-btn"
                        data-queue="{$queue.queue_name}">清空队列</button>
            </td>
        </tr>
        {/volist}
        {empty name="queues"}
        <tr>
            <td colspan="4" style="text-align:center;">暂无队列数据</td>
        </tr>
        {/empty}
        </tbody>
    </table>
</div>

<script src="/static/plugs/layui/layui.js"></script>
<script>
    layui.use(['layer', 'jquery'], function(){
        var layer = layui.layer;
        var $ = layui.jquery;

        // 清空队列按钮点击事件
        $('.clear-btn').click(function(){
            var queueName = $(this).data('queue');

            // 确认提示
            layer.confirm('确定要清空队列 <b>' + queueName + '</b> 吗？', {
                icon: 3,
                title: '确认清空'
            }, function(index){
                // 发送清空请求
                $.post('/admin/addtaskapi/clearRedisQueue', {
                    queue_name: queueName
                }, function(res){
                    if(res.code === 1){
                        layer.msg('队列清空成功', {icon: 1});
                        // 刷新页面
                        setTimeout(function(){
                            window.location.reload();
                        }, 1000);
                    }else{
                        layer.msg(res.msg || '操作失败', {icon: 2});
                    }
                }, 'json');

                layer.close(index);
            });
        });
    });
</script>
</body>
</html>